(function(t){"object"===typeof exports&&"undefined"!==typeof module?module.exports=t():"function"===typeof define&&define.amd?define([],t):("undefined"!==typeof window?window:"undefined"!==typeof global?global:"undefined"!==typeof self?self:this).Recorder=t()})(function(){return function c(e,k,n){function m(d,f){if(!k[d]){if(!e[d]){var a="function"==typeof require&&require;if(!f&&a)return a(d,!0);if(p)return p(d,!0);a=Error("Cannot find module '"+d+"'");throw a.code="MODULE_NOT_FOUND",a;}a=k[d]={exports:{}};
e[d][0].call(a.exports,function(a){var f=e[d][1][a];return m(f?f:a)},a,a.exports,c,e,k,n)}return k[d].exports}for(var p="function"==typeof require&&require,b=0;b<n.length;b++)m(n[b]);return m}({1:[function(c,e,k){e.exports=c("./recorder").Recorder},{"./recorder":2}],2:[function(c,e,k){var n=function(){function c(b,d){for(var f=0;f<d.length;f++){var a=d[f];a.enumerable=a.enumerable||!1;a.configurable=!0;"value"in a&&(a.writable=!0);Object.defineProperty(b,a.key,a)}}return function(b,d,f){d&&c(b.prototype,
d);f&&c(b,f);return b}}();Object.defineProperty(k,"__esModule",{value:!0});k.Recorder=void 0;var m=(c=c("inline-worker"))&&c.__esModule?c:{"default":c};c=k.Recorder=function(){function c(b,d){var f=this;if(!(this instanceof c))throw new TypeError("Cannot call a class as a function");this.config={bufferLen:4096,numChannels:2,mimeType:"audio/wav"};this.recording=!1;this.callbacks={getBuffer:[],exportWAV:[]};Object.assign(this.config,d);this.context=b.context;this.node=(this.context.createScriptProcessor||
this.context.createJavaScriptNode).call(this.context,this.config.bufferLen,this.config.numChannels,this.config.numChannels);this.node.onaudioprocess=function(a){if(f.recording){for(var d=[],b=0;b<f.config.numChannels;b++)d.push(a.inputBuffer.getChannelData(b));f.worker.postMessage({command:"record",buffer:d})}};b.connect(this.node);this.node.connect(this.context.destination);var a={};this.worker=new m["default"](function(){function d(){for(var a=0;a<e;a++)n[a]=[]}function f(a,d){for(var b=new Float32Array(d),
c=0,e=0;e<a.length;e++)b.set(a[e],c),c+=a[e].length;return b}function b(a,d,f){for(var c=0;c<f.length;c++)a.setUint8(d+c,f.charCodeAt(c))}var c=0,n=[],k=void 0,e=void 0;a.onmessage=function(l){switch(l.data.command){case "init":l=l.data.config;k=l.sampleRate;e=l.numChannels;d();break;case "record":l=l.data.buffer;for(var h=0;h<e;h++)n[h].push(l[h]);c+=l[0].length;break;case "exportWAV":l=l.data.type;for(var g=[],h=0;h<e;h++)g.push(f(n[h],c));if(2===e){for(var h=g[0],g=g[1],m=h.length+g.length,q=new Float32Array(m),
r=0,p=0;r<m;)q[r++]=h[p],q[r++]=g[p],p++;h=q}else h=g[0];g=new ArrayBuffer(44+2*h.length);g=new DataView(g);b(g,0,"RIFF");g.setUint32(4,36+2*h.length,!0);b(g,8,"WAVE");b(g,12,"fmt ");g.setUint32(16,16,!0);g.setUint16(20,1,!0);g.setUint16(22,e,!0);g.setUint32(24,k,!0);g.setUint32(28,4*k,!0);g.setUint16(32,2*e,!0);g.setUint16(34,16,!0);b(g,36,"data");g.setUint32(40,2*h.length,!0);m=44;for(q=0;q<h.length;q++,m+=2)r=Math.max(-1,Math.min(1,h[q])),g.setInt16(m,0>r?32768*r:32767*r,!0);l=new Blob([g],{type:l});
a.postMessage({command:"exportWAV",data:l});break;case "getBuffer":l=[];for(h=0;h<e;h++)l.push(f(n[h],c));a.postMessage({command:"getBuffer",data:l});break;case "clear":c=0,n=[],d()}}},a);this.worker.postMessage({command:"init",config:{sampleRate:this.context.sampleRate,numChannels:this.config.numChannels}});this.worker.onmessage=function(a){var d=f.callbacks[a.data.command].pop();"function"==typeof d&&d(a.data.data)}}n(c,[{key:"record",value:function(){this.recording=!0}},{key:"stop",value:function(){this.recording=
!1}},{key:"clear",value:function(){this.worker.postMessage({command:"clear"})}},{key:"getBuffer",value:function(b){b=b||this.config.callback;if(!b)throw Error("Callback not set");this.callbacks.getBuffer.push(b);this.worker.postMessage({command:"getBuffer"})}},{key:"exportWAV",value:function(b,d){d=d||this.config.mimeType;b=b||this.config.callback;if(!b)throw Error("Callback not set");this.callbacks.exportWAV.push(b);this.worker.postMessage({command:"exportWAV",type:d})}}],[{key:"forceDownload",value:function(b,
d){var f=(window.URL||window.webkitURL).createObjectURL(b),a=window.document.createElement("a");a.href=f;a.download=d||"output.wav";f=document.createEvent("Event");f.initEvent("click",!0,!0);a.dispatchEvent(f)}}]);return c}();k["default"]=c},{"inline-worker":3}],3:[function(c,e,k){e.exports=c("./inline-worker")},{"./inline-worker":4}],4:[function(c,e,k){(function(c){var k=function(){function c(d,a){for(var b in a){var e=a[b];e.configurable=!0;e.value&&(e.writable=!0)}Object.defineProperties(d,a)}
return function(b,a,e){a&&c(b.prototype,a);e&&c(b,e);return b}}(),p=!!(c===c.window&&c.URL&&c.Blob&&c.Worker),b=function(){function b(e,a){var k=this;if(!(this instanceof b))throw new TypeError("Cannot call a class as a function");if(p){var m=e.toString().trim().match(/^function\s*\w*\s*\([\w\s,]*\)\s*{([\w\W]*?)}$/)[1],m=c.URL.createObjectURL(new c.Blob([m],{type:"text/javascript"}));return new c.Worker(m)}this.self=a;this.self.postMessage=function(a){setTimeout(function(){k.onmessage({data:a})},
0)};setTimeout(function(){e.call(a)},0)}k(b,{postMessage:{value:function(b){var a=this;setTimeout(function(){a.self.onmessage({data:b})},0)}}});return b}();e.exports=b}).call(this,"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{}]},{},[1])(1)});
